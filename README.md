# AWS Comands & Exercises

### How to configure and set credentials:
Run:

	aws configure
	
Output:

	AWS Access Key ID [None]: AKIA3PGWxxxxxxCSR46MS
	AWS Secret Access Key [None]: VLddj3Sxxxxxxa4q0s
	Default region name [None]: eu-north-1  
	Default output format [None]: json

To test:

    aws sts get-caller-identity

	aws configure list

	aws ecr get-login-password --region eu-north-1 | docker login --username AWS --password-stdin 788577008603.dkr.ecr.eu-north-1.amazonaws.com

### To create security group:

	aws ec2 create-security-group --group-name my-sg --description "Mt SG"	

	aws ec2 describe-vpcs

	aws ec2 create-security-group --group-name my-sg --description "Mt SG" --vpc-id vpc-054cf680083727d58

	aws ec2 describe-security-groups     

	aws aws ec2 describe-security-groups --group-ids sg-0cbf57155c8e870e6

	aws ec2 authorize-security-group-ingress \
		--group-id sg-0cbf57155c8e870e6 \
		--protocol tcp \
		--port 22 \  
		--cidr 79.131.39.46/32

### To Create Key pair

 	aws ec2 create-key-pair \                                                                            
		 --key-name MyKpCli \
		 --query 'KeyMaterial' \
		 --output text > MyKpCli.pem

### To create Instance:

	aws ec2 run-instances \
	--image-id ami-04233b5aecce09244 \
	--count 1 \
	--instance-type t3.micro \
	--key-name MyKpCli \
	--security-group-ids sg-0cbf57155c8e870e6 \
	--subnet-id subnet-0b3376ca8dee484f2

### To get information about instances :

	aws ec2 describe-instances

	chmod 400 ~/MyKpCli.pem 

	ssh -i MyKpCli.pem ec2-user@13.60.232.93

### To create IAM group:

	aws iam create-group --group-name MyGroupCli

### To create IAM user:

	aws iam create-user --user-name MyUserCli

### IAM user to group:

	aws iam add-user-to-group --user-name MyUserCli --group-name MyGroupCli

### To Get info about IAM group

	aws iam get-group --group-name MyGroupCli

### To attach policy:

	aws iam attach-group-policy --group-name MyGroupCli --policy-arn arn:aws:iam::awe:policy/AmazonEC2FullAccess

### To show attached group policy:

	aws iam list-attached-group-policies --group-name MyGroupCli

### To createLogin profile :

	aws iam create-login-profile --user-name MyUserCli --password MyPassword! --password-reset-required

### To show account ID:

	aws iam get-user --user-name MyUserCli 

### How to attach policy to Change Password for user

	aws iam attach-user-policy \
  	--user-name MyUserCli \
  	--policy-arn arn:aws:iam::aws:policy/IAMUserChangePassword



### How to create Acceess Key for a new user:

  aws iam create-access-key --user-name MyUserCli    

	{
    "AccessKey": {
        "UserName": "MyUserCli",
        "AccessKeyId": "AKIAxxxxxxxxxJ3OWP",
        "Status": "Active",
        "SecretAccessKey": "ka‚Äùws ec2 ,
        "CreateDate": "2026-01-26T10:05:13+00:00"
    }
}


### How to Change AWS User for executing commands:

	export AWS_ACCESS_KEY_ID=xxxxxxxxxxOWP
	export AWS_SECRET_ACCESS_KEY=xxxxxxxxxpxBR

                                           
## EXERCISE 1: Create IAM user
First of all, you need an IAM user with correct permissions to execute the tasks below.

Create a new IAM user using "your name" as a username and "devops" as the user-group
Give the "devops" group all needed permissions to execute the tasks below - with login and CLI credentials
Note: Do that using the AWS UI with Admin User

1. Create the IAM group: devops

  1. Open AWS Console
  2. Go to IAM ‚Üí User groups
  3. Click Create group
  4. Group name: devops
  5.Permissions
    Attach policy:
    ‚úÖ AdministratorAccess
  6. Click Create group 

2. Create the IAM user (your name)

  1. In IAM ‚Üí Users
  2. Click Create user
  3. User name:
     julia
  4. Select AWS credential type
    ‚úÖ Provide user access to the AWS Management Console
    ‚úÖ Provide programmatic access (CLI)
       Console password
       Choose Autogenerated password (or custom if required)
    ‚úÖ Check User must create a new password at next sign-in

  5. Click Next

3. Add user to the devops group

  1. On Permissions step:
  2. Select Add user to group
  3. Choose devops
  4. Click Next

4. Click Create user
5. Save credentials (VERY IMPORTANT)

##  EXERCISE 2: Configure AWS CLI
You want to use the AWS CLI for the following tasks. So, to be able to interact with the AWS account from the AWS Command Line tool you need to configure it correctly:

Set credentials for that user for AWS CLI
Configure correct region for your AWS CLI

Befor I've created acceess key for julia user:

<img width="1165" height="604" alt="Screenshot 2026-01-28 at 10 40 04‚ÄØAM" src="https://github.com/user-attachments/assets/d7517e61-402a-4698-ae79-6cf3119e6be6" />

Then Run in a terminal :

	aws configure
Output:

	AWS Access Key ID [****************3OWP]: xxxxxxxxxxxxxx3OWP
	AWS Secret Access Key [****************4q0s]: xxxxxxxxxxxxx4q0s
	Default region name [eu-north-1]: eu-north-1
	Default output format [json]: json

To verify credentials are correctly set:

	aws sts get-caller-identity

Output:

	{
  		"UserId": "AIDAxxxxxxxxxxxx",
  		"Account": "788577008603",
  		"Arn": "arn:aws:iam::788577008603:user/julia"
	}

Check configured region:

	aws configure get region
Or:
	aws ec2 describe-availability-zones

AWS CLI saves everything locally:

Credentials

	~/.aws/credentials

Config

	~/.aws/config

## EXERCISE 3: Create VPC

You want to create the EC2 Instance in a dedicated VPC, instead of using the default one. So, using the AWS CLI, you:

create a new VPC with 1 subnet
create a security group in the VPC that will allow you access on ssh port 22 and will allow browser access to your Node application

1Ô∏è‚É£ Create a new VPC:

	aws ec2 create-vpc \
 		--cidr-block 10.0.0.0/16 \
  		--tag-specifications 'ResourceType=vpc,Tags=[{Key=Name,Value=devops-vpc}]'

	üìå Save the VPC ID from the output:

	"VpcId": "vpc-0abc123..."
	
2Ô∏è‚É£ Create a subnet in the VPC

	aws ec2 create-subnet \
  		--vpc-id <VPC_ID> \
  		--cidr-block 10.0.1.0/24 \
  		--availability-zone eu-north-1a \
  		--tag-specifications 'ResourceType=subnet,Tags=[{Key=Name,Value=devops-subnet}]'

	üìå Save the SubnetId.

3Ô∏è‚É£ Make the subnet public

3.1 Create an Internet Gateway

	aws ec2 create-internet-gateway \
  		--tag-specifications 'ResourceType=internet-gateway,Tags=[{Key=Name,Value=devops-igw}]'

	üìå Save the InternetGatewayId.

3.2 Attach Internet Gateway to VPC

	aws ec2 attach-internet-gateway \
  		--internet-gateway-id <IGW_ID> \
 		 --vpc-id <VPC_ID>

3.3 Create a route table

	aws ec2 create-route-table \
  	--vpc-id <VPC_ID> \
  	--tag-specifications 'ResourceType=route-table,Tags=[{Key=Name,Value=devops-rt}]'

	üìå Save the RouteTableId.
	
3.4 Add route to the Internet

	aws ec2 create-route \
  	--route-table-id <ROUTE_TABLE_ID> \
  	--destination-cidr-block 0.0.0.0/0 \
  	--gateway-id <IGW_ID>

3.5 Associate route table with subnet

	aws ec2 associate-route-table \
  	--route-table-id <ROUTE_TABLE_ID> \
  	--subnet-id <SUBNET_ID>

4Ô∏è‚É£ Create a Security Group in the VPC
	
	aws ec2 create-security-group \
  	--group-name devops-sg \
  	--description "Allow SSH and Node app access" \
  	--vpc-id <VPC_ID>

	üìå Save the GroupId.

5Ô∏è‚É£ Allow SSH (port 22)

	aws ec2 authorize-security-group-ingress \
  	--group-id <SECURITY_GROUP_ID> \
  	--protocol tcp \
  	--port 22 \
  	--cidr 0.0.0.0/0

6Ô∏è‚É£ Allow browser access to Node app
HTTP (port 80)

	aws ec2 authorize-security-group-ingress \
 	--group-id <SECURITY_GROUP_ID> \
  	--protocol tcp \
  	--port 80 \
  	--cidr 0.0.0.0/0


## EXERCISE 4: Create EC2 Instance
Once the VPC is created, using the AWS CLI, you:

Create an EC2 instance in that VPC with the security group you just created and ssh key file

How to see what key pairs exist in region?

	aws ec2 describe-key-pairs --region eu-north-1 --query 'KeyPairs[*].KeyName' --output table

Create the julia-key key pair (eu-north-1)

	aws ec2 create-key-pair \
  	--region eu-north-1 \
  	--key-name julia-key \
  	--query 'KeyMaterial' \
  	--output text > julia-key.pem

	chmod 400 julia-key.pem

Launch the EC2 instance

	INSTANCE_ID=$(aws ec2 run-instances \
 	 --region "$REGION" \
  	--image-id "$AMI_ID" \
  	--instance-type t3.micro \
	--key-name julia-key \
  	--subnet-id "$SUBNET_ID" \
  	--security-group-ids "$SG_ID" \
  	--tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=devops-ec2}]' \
  	--query 'Instances[0].InstanceId' \
  	--output text)

	INSTANCE_ID=$(aws ec2 run-instances \
	cmdsubst> --region "$REGION" \
	cmdsubst> --image-id "$AMI_ID" \
	cmdsubst> --instance-type t3.micro \
	cmdsubst> --key-name julia-key \
	cmdsubst> --subnet-id "$SUBNET_ID" \
	cmdsubst> --security-group-ids "$SG_ID" \
	cmdsubst> --associate-public-ip-address \
	cmdsubst> --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=devops-ec2}]' \
	cmdsubst> --query 'Instances[0].InstanceId' \
	cmdsubst> --output text
	cmdsubst> )

	echo "InstanceId: $INSTANCE_ID"

Fetch public IP

	aws ec2 wait instance-running --region "$REGION" --instance-ids "$INSTANCE_ID"

Get public IP

	PUBLIC_IP=$(aws ec2 describe-instances \
  	--region "$REGION" \
  	--instance-ids "$INSTANCE_ID" \
  	--query 'Reservations[0].Instances[0].PublicIpAddress' \
  	--output text)

	echo "Public IP: $PUBLIC_IP"

SSH into the instance

	ssh -i julia-key.pem ec2-user@$PUBLIC_IP



